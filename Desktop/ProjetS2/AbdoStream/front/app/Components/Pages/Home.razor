@page "/"
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager

<PageTitle>AbdoStream - Votre plateforme de films</PageTitle>
<link href="css/Home.css" rel="stylesheet" />

<header class="header">
    <div class="logo">
        <a href="/" class="logo-link">
            <span class="logo-icon">üé•</span>
            <h1 class="logo-text">AbdoStream</h1>
        </a>
    </div>
    <nav class="navigation">
        <input type="checkbox" id="nav-toggle" class="nav-toggle" />
        <label for="nav-toggle" class="nav-toggle-label">
            <span></span>
        </label>
        <ul class="nav-links">
            <li><a href="/" class="nav-link active">Accueil</a></li>
            <li><a href="/films" class="nav-link">Films</a></li>
            @if(isUserAuthenticated && isAdmin)
            {
                <li><a href="/omdb" class="nav-link">OMDB</a></li>
            }
            <li><a href="/favorites" class="nav-link">Favoris</a></li>
            <li><a href="/Allusers" class="nav-link">Utilisateurs</a></li>
            <li><a href="/suggestions" class="nav-link">Suggestions</a></li>
            @if (!isUserAuthenticated)
            {
                <li><a href="/Login" class="btn-primary">Connexion</a></li>
            }
            else
            {
                <li><a href="/logout" class="btn-secondary">D√©connexion</a></li>
            }
        </ul>
    </nav>
</header>

<main>
    @if (!isUserAuthenticated)
    {
        <section class="hero">
            <div class="hero-content">
                <h2 class="hero-title">Explorez et g√©rez vos films pr√©f√©r√©s</h2>
                <p class="hero-subtitle">D√©couvrez de nouveaux films, cr√©ez votre collection personnalis√©e, et organisez vos favoris en un clic.</p>
                <div class="cta-buttons">
                    <a href="/Signup" class="btn btn-primary">Cr√©er un compte</a>
                    <a href="/Login" class="btn btn-outline">Se connecter</a>
                </div>
            </div>
            <div class="hero-image">
                <img src="images/hero-image.png" alt="Biblioth√®que virtuelle de films" class="hero-img" />
            </div>
        </section>
    }
    else
    {
        <AuthorizeView>
            <Authorized>
                <section class="welcome-section">
                    <div class="welcome-content">
                        <div class="welcome-container">
                            <div class="avatar-container">
                                <img src="images/animated-avatar.gif" alt="Avatar anim√©" class="avatar-img" />
                            </div>
                            <div class="welcome-message">
                                <h2>Bienvenue, <span class="username">@context.User.Identity?.Name !</span></h2>
                                <p>Que souhaitez-vous explorer aujourd'hui ?</p>
                                <div class="quick-actions">
                                    <a href="/films" class="action-btn">
                                        <span class="action-icon">üé¨</span>
                                        Explorer les films
                                    </a>
                                    <a href="/favorites" class="action-btn">
                                        <span class="action-icon">‚≠ê</span>
                                        Mes favoris
                                    </a>
                                    <a href="/suggestions" class="action-btn">
                                        <span class="action-icon">üí°</span>
                                        Suggestions
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-image">
                        <img src="images/hero-image2.png" alt="Biblioth√®que virtuelle de films" class="hero-img" />
                    </div>
                </section>
            </Authorized>
        </AuthorizeView>
    }

    <section class="features">
        <h3 class="section-title">Pourquoi choisir AbdoStream ?</h3>
        <div class="feature-grid">
            <div class="feature-item">
                <div class="feature-icon">üìã</div>
                <h4 class="feature-title">Organisez facilement vos films</h4>
                <p class="feature-description">Cat√©gorisez et triez vos films pr√©f√©r√©s en un seul endroit.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">‚≠ê</div>
                <h4 class="feature-title">Cr√©ez des listes personnalis√©es</h4>
                <p class="feature-description">Gardez vos films favoris toujours √† port√©e de main.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üìä</div>
                <h4 class="feature-title">Suivez vos visionnages</h4>
                <p class="feature-description">Ne perdez jamais le fil de vos films regard√©s.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üíª</div>
                <h4 class="feature-title">Interface moderne et intuitive</h4>
                <p class="feature-description">Une exp√©rience utilisateur pens√©e pour vous.</p>
            </div>
        </div>
    </section>

    <section class="latest-films">
        <h3 class="section-title">Films r√©cemment ajout√©s</h3>
        <div class="film-carousel">
            @* Cette section sera remplie dynamiquement avec les films r√©cents *@
            <div class="film-placeholder">
                <div class="film-card">
                    <div class="film-poster"></div>
                    <div class="film-info">
                        <h4>Titre du film</h4>
                        <p>2025 | Action</p>
                    </div>
                </div>
            </div>
            <div class="film-placeholder">
                <div class="film-card">
                    <div class="film-poster"></div>
                    <div class="film-info">
                        <h4>Titre du film</h4>
                        <p>2025 | Aventure</p>
                    </div>
                </div>
            </div>
            <div class="film-placeholder">
                <div class="film-card">
                    <div class="film-poster"></div>
                    <div class="film-info">
                        <h4>Titre du film</h4>
                        <p>2025 | Com√©die</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="see-more">
            <a href="/films" class="btn btn-outline">Voir tous les films</a>
        </div>
    </section>

    <section class="testimonials">
        <h3 class="section-title">Ce que disent nos utilisateurs</h3>
        <div class="testimonial-container">
            <div class="testimonial-item">
                <div class="testimonial-avatar">üë©</div>
                <div class="testimonial-content">
                    <p>"AbdoStream m'a permis de d√©couvrir et d'organiser mes films pr√©f√©r√©s. Une plateforme incroyable !"</p>
                    <div class="testimonial-author">Sarah, passionn√©e de cin√©ma</div>
                    <div class="testimonial-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
            </div>
            <div class="testimonial-item">
                <div class="testimonial-avatar">üë®</div>
                <div class="testimonial-content">
                    <p>"Une interface intuitive et un design √©l√©gant. Je recommande vivement !"</p>
                    <div class="testimonial-author">Paul, utilisateur satisfait</div>
                    <div class="testimonial-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
            </div>
            <div class="testimonial-item">
                <div class="testimonial-avatar">üë©</div>
                <div class="testimonial-content">
                    <p>"AbdoStream a transform√© ma fa√ßon de d√©couvrir des films. C'est devenu mon outil indispensable !"</p>
                    <div class="testimonial-author">Marie, cin√©phile</div>
                    <div class="testimonial-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta-section">
        <div class="cta-content">
            <h3>Pr√™t √† d√©couvrir une nouvelle fa√ßon d'explorer le cin√©ma ?</h3>
            <p>Rejoignez des milliers d'utilisateurs et commencez d√®s aujourd'hui.</p>
            @if (!isUserAuthenticated)
            {
                <a href="/Signup" class="btn btn-large">Commencer gratuitement</a>
            }
            else
            {
                <a href="/films" class="btn btn-large">Explorer les films</a>
            }
        </div>
    </section>
</main>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-section">
            <div class="footer-logo">
                <span class="logo-icon">üé•</span>
                <h3 class="footer-logo-text">AbdoStream</h3>
            </div>
            <p class="footer-description">Votre plateforme de gestion et d√©couverte de films pr√©f√©r√©s.</p>
        </div>
        <div class="footer-section">
            <h3 class="footer-title">Liens rapides</h3>
            <ul class="footer-links">
                <li><a href="/">Accueil</a></li>
                <li><a href="/films">Films</a></li>
                <li><a href="/favorites">Favoris</a></li>
                <li><a href="/suggestions">Suggestions</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h3 class="footer-title">Informations l√©gales</h3>
            <ul class="footer-links">
                <li><a href="/politique-de-confidentialite">Politique de confidentialit√©</a></li>
                <li><a href="/conditions-generales">Conditions g√©n√©rales</a></li>
                <li><a href="/support">Support</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h3 class="footer-title">Suivez-nous</h3>
            <div class="footer-social">
                <a href="#" class="social-link">
                    <span class="social-icon">üì±</span>
                    <span class="social-name">Facebook</span>
                </a>
                <a href="#" class="social-link">
                    <span class="social-icon">üì±</span>
                    <span class="social-name">Twitter</span>
                </a>
                <a href="#" class="social-link">
                    <span class="social-icon">üì±</span>
                    <span class="social-name">Instagram</span>
                </a>
            </div>
        </div>
    </div>
    <div class="copyright">
        <p>¬© 2025 AbdoStream. Tous droits r√©serv√©s.</p>
    </div>
</footer>

@code {
    private bool isUserAuthenticated;
    private bool isAdmin;   

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        isUserAuthenticated = user.Identity?.IsAuthenticated ?? false;
        isAdmin = await IsUserInRoleAsync("Admin");
    }

    private async Task<bool> IsUserInRoleAsync(string role)
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        return user.IsInRole(role);
    }
}